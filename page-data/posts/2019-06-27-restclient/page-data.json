{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/posts/2019-06-27-restclient","webpackCompilationHash":"c8ed51f8e74f03200d92","result":{"data":{"site":{"siteMetadata":{"title":"Excursion in Distraction","author":"@dsvensson"}},"markdownRemark":{"html":"<p>I’ve been using <a href=\"https://github.com/pashky/restclient.el\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><code class=\"language-text\">restclient</code></a> for quite some time now, but it wasn’t until a couple of months ago I got annoyed enough to find its variable and scripting support. To showcase my findings I’ve put together a small example of accessing the <a href=\"https://developer.github.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">GitHub GraphQL API</a> using the <a href=\"https://github.com/vermiculus/graphql.el\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><code class=\"language-text\">graphql</code></a> package. This is only a sample, and for proper GitHub interaction it would be better to use the <a href=\"https://github.com/magit/ghub\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><code class=\"language-text\">ghub</code></a> package.</p>\n<p>The most basic assignment using plain <code class=\"language-text\">=</code> operator:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">:graphql-url = https://api.github.com/graphql</code></pre></div>\n<p>Replacing the <code class=\"language-text\">=</code> operator with <code class=\"language-text\">:=</code> evaluates the right hand side as elisp:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">:github-token := (auth-source-pass-get &quot;token&quot; &quot;web/github&quot;)</code></pre></div>\n<p>This also showcases accessing extra data in the password store <a href=\"https://www.passwordstore.org/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><code class=\"language-text\">pass</code></a>, via <a href=\"https://github.com/DamienCassou/auth-password-store\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><code class=\"language-text\">auth-password-store</code></a>. The content of <code class=\"language-text\">web/github</code> would be something like:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ pass web/github\ns1kr1ttp4zzw0rd\ntoken: b0baf377b0baf377b0baf377b0baf377b0baf377</code></pre></div>\n<p>Multi-line support via <code class=\"language-text\">&lt;&lt;</code>, and referring to other variables:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">:headers = &lt;&lt;\nAuthorization: Bearer :github-token\nUser-Agent: Emacs\n#</code></pre></div>\n<p>…and for scripting by combining the <code class=\"language-text\">:=</code> and <code class=\"language-text\">&lt;&lt;</code> operators:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">:query-repos := &lt;&lt;\n(graphql-query\n ((viewer\n   (repositories\n    :arguments\n    ((first . 3)\n     (orderBy . ((direction . DESC)\n                 (field     . UPDATED_AT))))\n    (nodes\n     name\n     pushedAt)))))\n#</code></pre></div>\n<p>Finally the actual HTTP call, using the variables now assigned:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">POST :graphql-url\n:headers\n{ &quot;query&quot;: &quot;:query-repos&quot;}</code></pre></div>\n<p>Executing the following via <kbd>C-c</kbd> <code class=\"language-text\">+</code> <kbd>v</kbd> will result in:</p>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/482431e0a1985b086383807f6637b704/321d0/restclient.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 650px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 68.43033509700177%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAABYlAAAWJQFJUiTwAAABzElEQVQoz22S624bIRCF91GqNF7vcofhDk7Wsh0nqixF+dv3f48Oi+26UaWzCLF8c4YDAwsHnt64zQKCsEGAUy5Q7SZmJ25nEXTMJmYiPK5saVP7tWqg6UzzB9XJgLU+gpYKgBrLwVJlR2KIdP6lmFyYClQ51CzcFS6vn/XlYmNkxgnwwvip1+bX8iMBxKBkHaItCXKSLsy88YOMJ5HfWToxU4kME67+I+wTmIkmJWkD8swEbnw3H8JyWX79tuWdqkR1JjLihOncRURAmCMc0TCiJ9MedXUWOr8dv1I5+Xo0YfHlKO3uAW77qAqIce05YJY43pyFqXn5ELZC3AuoLh20e73DVEamYsuZQItgjQN7uaUto/V7qet6B66P6NaFzsJkrhM3Cau0iU79V4P1cnH5bKByg+fB3e5+jSjcJG3tQphKvK1A5O3MTEeiHJGWmZbEf2AoylUBhfb+Kfxt+3oG+v313GHEtNt1c+wZr7On2OCZfQceBL1t5XYKx5XvcBtlGPDbcjPjM+b2sau1dgtM2sJNbrYG3z9OCvbC1xQH589gYwh755dQDlyFHz/pOCsssVF1Q91I5EjUZlbPW/E0sqeRbyb5PElc+QPcH6GwM4WEAAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"restclient\"\n        title=\"\"\n        src=\"/static/482431e0a1985b086383807f6637b704/dbb61/restclient.png\"\n        srcset=\"/static/482431e0a1985b086383807f6637b704/19bd1/restclient.png 163w,\n/static/482431e0a1985b086383807f6637b704/d3bcb/restclient.png 325w,\n/static/482431e0a1985b086383807f6637b704/dbb61/restclient.png 650w,\n/static/482431e0a1985b086383807f6637b704/6b691/restclient.png 975w,\n/static/482431e0a1985b086383807f6637b704/91670/restclient.png 1300w,\n/static/482431e0a1985b086383807f6637b704/321d0/restclient.png 2268w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n      />\n  </span>\n  </a></p>\n<p>As seen by the screenshot, the elisp sections are highlighted correctly. This performed by the <a href=\"https://github.com/polymode/polymode\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><code class=\"language-text\">polymode</code></a> package which enables embedding of multiple major modes within the same buffer. While configuring this for <code class=\"language-text\">restclient</code> I found a couple of bugs, and within a day of interacting with the maintainer the issues got resolved - so it seems like a good package to depend on.</p>\n<p>The definition for the elisp sections within <code class=\"language-text\">restclient</code> buffers is as follows:</p>\n<div class=\"gatsby-highlight\" data-language=\"elisp\"><pre class=\"language-elisp\"><code class=\"language-elisp\"><span class=\"token punctuation\">(</span><span class=\"token car\">define-hostmode</span> pm/restclient-hostmode\n  <span class=\"token lisp-property property\">:mode</span> <span class=\"token quoted-symbol variable symbol\">'restclient-mode</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">(</span><span class=\"token car\">define-innermode</span> pm/restclient-innermode\n  <span class=\"token lisp-property property\">:mode</span> <span class=\"token quoted-symbol variable symbol\">'emacs-lisp-mode</span>\n  <span class=\"token lisp-property property\">:head-mode</span> <span class=\"token quoted-symbol variable symbol\">'host</span>\n  <span class=\"token lisp-property property\">:tail-mode</span> <span class=\"token quoted-symbol variable symbol\">'host</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">(</span><span class=\"token car\">define-innermode</span> pm/restclient-single-innermode pm/restclient-innermode\n  <span class=\"token lisp-property property\">:head-matcher</span> <span class=\"token string\">\"^:[^ ]+ :=\"</span>\n  <span class=\"token lisp-property property\">:tail-matcher</span> <span class=\"token string\">\"\\n\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">(</span><span class=\"token car\">define-innermode</span> pm/restclient-multi-innermode pm/restclient-innermode\n  <span class=\"token lisp-property property\">:head-matcher</span> <span class=\"token string\">\"^:[^ ]+ := &lt;&lt;\\n\"</span>\n  <span class=\"token lisp-property property\">:tail-matcher</span> <span class=\"token string\">\"^#\\n\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">(</span><span class=\"token car\">define-polymode</span> pm/restclient-mode\n  <span class=\"token lisp-property property\">:hostmode</span> <span class=\"token quoted-symbol variable symbol\">'pm/restclient-hostmode</span>\n  <span class=\"token lisp-property property\">:innermodes</span> <span class=\"token punctuation\">'(</span><span class=\"token car\">pm/restclient-single-innermode</span>\n                pm/restclient-multi-innermode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Another useful package is <a href=\"https://github.com/iquiw/company-restclient\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><code class=\"language-text\">company-restclient</code></a> which, thanks to <a href=\"https://github.com/for-GET/know-your-http-well\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><code class=\"language-text\">know-your-http-well</code></a>, adds completion for pretty much everything that goes into a HTTP header.</p>","fields":{"slug":"posts/2019-06-27-restclient","readingTime":{"text":"2 min read"}},"frontmatter":{"title":"restclient.el","date":"27 Jun '19"}},"headerImage":{"childImageSharp":{"fluid":{"tracedSVG":"data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' width='400' height='27'%3e%3cpath d='M2 1L1 13l-1 6c0 4 0 4 3 4 2 0 2 0 1 1H1l-1 1c0 2 3 2 15 2h14v-5c0-5-1-6-3-4v3c0 1-2 2-5 2l-4 1-2 1-2-1c0-2 6-4 9-4 3 1 3-1-1-2-3 0-1-2 4-2 3 0 4-1 4-3l-1-3H16C5 10 5 10 5 3c0-3-2-4-3-2m32 13v13h9c7 0 9 0 9-2 0 0-1-2-3-2-3-1-3-1-2-8V9h-3l-4 1V5c0-5 0-5-3-5h-2l-1 14m20-2v11h4c3 0 4 0 5 2 0 2 1 2 14 2 16 0 15 1 15-11 0-8 1-12 3-12l1 10c0 6 0 9 1 8 1-2 1-2 1 0 1 1 1 2 2 1l2 1 1 2V4c0-3-1-4-6-4-6 0-6 0-5 2 0 4-8 7-20 7h-9V0h-9v12m57-5c-1 8 0 14 4 17v1l-2 1 14 1 14-1h2l10 1c11 0 11 1 11-22V0l-2 3-2 4c1 1 0 1-3 1l-7 1-5-1c-3-3-2-5 1-5l3-1h-3l-3-1-2-1-1 1c1 0-1 3-3 3l-3-2c-3-2-4-2-9-2h-11c-3 0-3 0-3 7m68-4c0 3 0 3 2 1 0-1 2-2 3-1 1 0 1 1-1 3-2 1-2 2-1 2v1l-1 3c0 1-1 2-2 1v6c0 1 1 2 5 2 7 2 8 2 2 2l-6 1h2l3 1c0 1 2 2 10 2 9 0 10 0 10-2 0-1 1-2 3-2h3V0h-33l1 3m36-2c-2 2 0 26 1 26v-1c0-2 1-2 3 0l9 1h8l-2-3-1-2c1-1-6-14-7-13-2 1-5-1-5-5-1-3-1-3-2-1l-1 3V3c0-2-2-4-3-2m99 0c-1 2 3 8 5 9v3l-1-1-2-1 1 2v2c-2 1-2 1-2-1s0-2-1-1h-2l-1 2 1 2 1-1h1l-1 2-1 3-2-3c-2-2-7-2-5 0h2l1 1-3 1c-2 0-2 0-2 2l1 3c0 2 1 2 48 2h48V15c0-10 0-11-2-11-1 0-2 0-2-2 0-3-9-3-11 0v2h-1l-1 1c-1 1-1 0-1-2 1-4-1-4-2 0 0 2-1 2-1 1V2c0-2 0-2-1-1l-2 1c1 4-1 6-4 5-4 0-6-2-3-2 2 0 2 0 1-1-2 0-2-1-1-2l2 1c0 2 1 1 3-1 1-2 0-2-3-2l-7 2c-2 1-2 2-1 2h2l-2 1-2 2 2 1c2-1 4 0 4 2l-5 1-6 1h-1l2-2 1-2-2-4V0h-9c-9 0-10 0-10 2l-1 3V2c0-2-1-2-3-2l-3 1h-2c-2-1-7-1-7 1l1 1v1c0 2-2 0-2-2s-5-3-6-1m-44 7l-1 1c-1-1-1 1-1 3 0 4 0 4-1 1 0-3-1-3-5-4l-6-1c-1 0-1 4 1 10l2 6c1 3 1 3 11 3 7 0 9 0 9-2v-3l-2-2-2-5-3-5c-1-4-2-5-2-2' fill='%23d3d3d3' fill-rule='evenodd'/%3e%3c/svg%3e","aspectRatio":14.867924528301886,"src":"/static/843c5f7defd25c41f8cae57182fd6f1f/1bdc6/wastelands-header.jpg","srcSet":"/static/843c5f7defd25c41f8cae57182fd6f1f/accda/wastelands-header.jpg 200w,\n/static/843c5f7defd25c41f8cae57182fd6f1f/fc61b/wastelands-header.jpg 400w,\n/static/843c5f7defd25c41f8cae57182fd6f1f/1bdc6/wastelands-header.jpg 800w,\n/static/843c5f7defd25c41f8cae57182fd6f1f/34bdc/wastelands-header.jpg 1200w,\n/static/843c5f7defd25c41f8cae57182fd6f1f/bdccb/wastelands-header.jpg 1600w,\n/static/843c5f7defd25c41f8cae57182fd6f1f/0ffcb/wastelands-header.jpg 3940w","sizes":"(max-width: 800px) 100vw, 800px"}}},"indexImage":null},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"posts/2019-06-27-restclient","previous":{"fields":{"slug":"posts/2018-07-13-cc1101"},"frontmatter":{"title":"Electrosmog trapping with CC1101"}},"next":null}}}